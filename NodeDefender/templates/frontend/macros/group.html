{% macro ListGroups(groups = None) %}
<table class="table table-hover" id="grouptable">
	<thead>
		<tr>
			<th>Name</th>
			<th>Description</th>
			<th>Users</th>
			<th>Nodes</th>
		</tr>
	</thead>
	<tbody id="grouptbody">
		{% if groups %}
		{% for group in groups %}
		<tr>
			<td>
				<a href="{{url_for('AdminView.AdminGroup', name = serialize(group.name))}}">
				{{group.name}}
				</a>
			</td>
			<td>
				<a href="{{url_for('AdminView.AdminGroup', name = serialize(group.name))}}">
					{{group.description}}
				</a>
			</td>
			<td>
				<a href="{{url_for('AdminView.AdminGroup', name = serialize(group.name))}}">
				{{group.users|count}}
				</a>
			</td>
			<td>
				<a href="{{url_for('AdminView.AdminGroup', name = serialize(group.name))}}">
					{{group.nodes|count}}
				</a>
			</td>
		</tr>
		{% endfor %}
		{% endif %}
	</tbody>
</table>
{% if groups %}

{% else %}
	<script>
grouptbody = document.getElementById('grouptbody');
grouptable = document.getElementById('grouptable');
	function groupList(groups) {
		for (var i = 0; i < groups.length; i++) {
			groupSocket.emit('info', ({'name' : groups[i]}));
		}
	};

	function clearGroupList() {
		while (grouptable.rows.length > 0)
			grouptable.deleteRow(0);
	};

	groupSocket.on('info', function(group) {
		var newRow = grouptbody.insertRow(0);

		var nameCell = newRow.insertCell(0);
		var nameText = document.createTextNode(group.name);
		nameCell.appendChild(nameText);

		var descCell = newRow.insertCell(1);
		var descText = document.createTextNode(group.description);
		descCell.appendChild(descText);

		var usersCell = newRow.insertCell(2);
		var usersText = document.createTextNode(group.users.length);
		usersCell.appendChild(usersText);
		
		var nodesCell = newRow.insertCell(3);
		var nodesText = document.createTextNode(group.nodes.length);
		nodesCell.appendChild(nodesText);
	});
	</script>
{% endif %}
{% endmacro %}

{% macro CreateGroup(Form) %}
{% from "frontend/macros/form.html" import render_field_with_errors, render_field %}
<form action="{{url_for('AdminView.AdminGroups')}}" method="POST" class="form-horizontal">
	{{ Form.csfr_token }}
	{{ Form.hidden_tag() }}
	{{ render_field_with_errors(Form.Name) }}
	{{ render_field_with_errors(Form.Description) }}
	{{ render_field_with_errors(Form.Email) }}
	{{ render_field(Form.Submit) }}
</form>
{% endmacro %}

{% macro GroupInfo(Group) %}
{% from "frontend/macros/info.html" import Field %}
<div class="row">
	{{Field('Name', Group.name)}}
	{{Field('Description', Group.description)}}
	{{Field('Street', Group.location.street)}}
	{{Field('City', Group.location.city)}}
	{{Field('Created', Group.created_on)}}
</div>
{% endmacro %}

{% macro SelectGroup(user) %}
{% from "frontend/macros/info.html" import FieldID %}
<div class="form-group">
	<label for="sell">Avalible Groups: </label>
	<select class="form-control" id="GroupsList"></select>
</div>
<form class="form-horizontal">
	<div class="row">
		{{ FieldID('Name', '-', 'Groupname') }}
		{{ FieldID('Description', '-', 'Groupdesc') }}
		{{ FieldID('Users', '-', 'Groupusers') }}
		{{ FieldID('Nodes', '-', 'Groupnodes') }}
	</div>
</form>
<script>
$(document).ready(function() {
	groupSocket.emit('list', ('{{user.email}}'));

	groupSocket.on('list', function(groups) {
		var glength = groups.length;
		if (glength < 1) {
			return 
		}
		
		for (var i = 0; i < glength; i++) {
			$('#GroupsList').append('<option>'+  groups[i].name + '</option>');
		}
		groupSocket.emit('info', {'name' : groups[0].name});
	});

	groupSocket.on('info', function(group) {
		$('#Groupname').text(group.name);
		$('#Groupdesc').text(group.description);
		$('#Groupusers').text(group.users.length);
		$('#Groupnodes').text(group.nodes.length);
	});

	$('#GroupsList').change(function() {
		var name = $('#GroupsList option:selected').text();
		groupSocket.emit('info', {'name' : name});
	});

	var addToGroup = function() {
		groupname = $('#Groupname').text();
		groupSocket.emit('addUser', {'user' : '{{user.email}}', 'group' : groupname});
	}

	try {
		document.getElementById('addToGroup').onclick = function() {addToGroup();};
	}
	catch (err) {
		console.log('addToGroup not found');
	}
});
</script>

{% endmacro %}
