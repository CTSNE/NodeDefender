{% extends "base.html" %}
{% block content %}
<!-- Page Heading -->
<div class="row">
	<div class="col-lg-12">
		<h1 class="page-header">
			Dashboard <small> Overview</small>
		</h1>
		<ol class="breadcrumb">
			<li class="active">
				<i class="fa fa-dashboard"></i> Dashboard
			</li>
		</ol>
	</div>
</div>
{% include "flash.html" %}
<div class="row">
	<div class="col-lg-12">
		<div class="box" style="padding: 0;">
			<div id="map" style="height: 300px; width: 100%; "></div>
		</div>
	</div>
</div>
<br>
<div class="row">
	<div class="col-lg-4">
		<div class="box">
			<h2 style="display: inline;">Average node heat</h2>
			<h3 style="display: inline;"> : {{"%0.2f" % stats.hourly['heat']|float }}°C</h3>
			<br><br>
			<h4 style="display: inline" id="heat-history"></h4>
		</div>
	</div>
 	<div class="col-lg-4">
		<div class="box">
			<h2 style="display: inline;">Power Consumption</h2>
			<h3 style="display: inline;"> : {{"%0.2f" % stats.hourly['power']|float}} W</h3>
			<br><br>
			<h4 style="display: inline" id="power-history"></h4>
		</div>
	</div>
	<div class="col-lg-4">
		<div class="box">
			<h2 style="display: inline;">Events last hour</h2>
			<h3 style="display: inline;"> : {{stats.hourly['events']}}</h3>
			<br><br>
			<h4 style="display: inline" id="events-history"></h4>
		</div>
	</div>
</div>
<br>
<div class="row">
	<div class="col-lg-6">
		<h3>Messages</h3>
		<div class="box" style="padding: 0;">
			<div class="panel-group" id="accordion">
				{% for message in messages %}
				  <div class="panel panel-default">
						<div class="panel-heading">
							<h4 class="panel-title">
								<a data-toggle="collapse" href="#collapse{{message.id}}">
									<i class="fa fa-envelope" aria-hidden="true"></i>
									{{ moment(message.created_on).format('Do MMM YYYY, HH:mm:ss') }} - <b>{{ message.subject }}</b></a>
							</h4>
						</div>
						<div id="collapse{{message.id}}" class="panel-collapse collapse in">
							<div class="panel-body">{{ message.body }}</div>
						</div>
					</div>
					{% endfor %}
				</div>
			</div>
	</div>
	<div class="col-lg-6">
		<h3>Node Events</h3>
		<div class="box" style="padding: 0;">
					<table class="table table-striped">
						<thead>
							<tr>
								<th>Event</th>
								<th>iCPE</th>
								<th>ZWave</th>
								<th>Date</th>
							</tr>
						</thead>
						<tbody>
					{% for event in nodeevents %}
					<tr>
						<td>
							<i class="fa fa-{{event.fonticon}}" aria-hidden="true"></i>
						</td>
						<td>
							{{ event.parent.alias }}
						</td>
						<td>
							{{ event.productname }}
						</td>
						<td>
							{{ moment(event.created_on).format('Do MMM YYYY, HH:mm:ss') }}
						</td>
					</tr>
					{% endfor %}
						</tbody>
					</table>
		</div>
	</div>
<script>

var map = L.map('map',{
    center: [57.691, 11.936],
    zoom: 9
});

L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
    attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
}).addTo(map);

{% for node in nodelist %}
var marker = L.marker([{{node.location.geolat}}, {{node.location.geolong}}]).addTo(map);
marker.bindPopup("<a href=\"/nodes/list/{{node.mac}}\">{{node.alias}}<br>{{node.location.street}},<br>{{node.location.city}}</a>");
{% endfor %}

// Data for Heat
var HeatDaily = {{"%0.2f" % stats.daily['heat']|float }}
// Data for Power
var PowerDaily = {{"%0.2f" % stats.daily['power']|float }}
// Data for Events
var EventsDaily = {{stats.daily['events']}}

$(document).ready(function() {
	$("#heat-history").text("Daily average: " + HeatDaily + " °C");
	$("#power-history").text("Daily average: " + PowerDaily + " W");
	$("#events-history").text("Daily average: " + EventsDaily);


});
</script>

{% endblock %}
