{% macro Lookup(iCPE) %}
<script>
socket.on('SensorRespond', function(sensor, fields) {
	console.log(fields);
	for (var field in fields) {
		box = $(document.getElementById(sensor.sensorid + field.name));
		if (field.type == 'checkbox') {
			boxChange(box, field.value);
		}
		else if (field.type == ) {
		}
	}
	console.log("Sensor Loaded " + sensor.sensorid);
	$(document.getElementById("Box" + sensor.sensorid)).removeClass("blur");
});

{% for sensor in iCPE.sensors %}
	$(document.getElementById("Box" + {{sensor.sensorid}})).addClass("blur");
	socket.emit('SensorGet', {macaddr : "{{sensor.icpe.mac}}", sensorid : "{{sensor.sensorid}}"});
{% endfor %}

</script>
{% endmacro %}

{% macro EventListener(macaddr) %}
<script>
var eventsocket = io.connect('http://' + document.domain + ':' + location.port + '/icpe' + '{{macaddr}}');


function switchChange(box, macaddr, sensorid, cmdclass, classtype) {
	if (box.checked) {
		socket.emit('event', {macaddr : macaddr, sensorid : sensorid, cmdclass : cmdclass, classtype : classtype, event : '1'});
	} else {
		socket.emit('event', {macaddr : macaddr, sensorid : sensorid, cmdclass : cmdclass, classtype : classtype, event : '0'});
	}
}

function switchEvent(field, value) {
	if (value) {
		field.attr("checked", true);
	} else {
		field.attr("checked" false);
	}
}


function boxChange(box, value) {
 if(value) {
	 $(box).addClass('lightboxlight');
 } else {
	 $(box).removeClass('lightboxlight');
 }
}

function fieldChange(box, value) {
	$(box).text(value);
}



eventsocket.on('FieldEvent', function(sensor, field, value) {
	f = document.getElementById(sensor.sensorid+field.name);
	if (field.type == 'switch') {
		switchEvent(f, value);
	} else if (field.type == 'box') {
		boxEvent(f, value);
	} else if (field.type == 'value') {
		valueEvent(f, value);
	}
});
</script>
{% endmacro %}
